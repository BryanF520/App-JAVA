<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/app.html}"
>
  <head>
    <meta charset="UTF-8" />
    <title>Empresas</title>
  </head>

  <body>
    <section layout:fragment="content">
      <!-- Mensaje de error -->
      <div
        th:if="${error}"
        class="alert alert-danger mb-3"
        th:text="${error}"
      ></div>

      <div class="card-custom">
        <!-- ======================================== -->
        <!--   HEADER / ACCIONES SUPERIORES            -->
        <!-- ======================================== -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="page-title mb-0">Empresas Activas</h2>

          <div class="d-flex gap-2" sec:authorize="hasRole('Administrador')">
            <a th:href="@{/empresas/create}" class="btn-primary-custom">
              <i class="bi bi-plus-circle"></i> Nueva Empresa
            </a>

            <a th:href="@{/empresas/inactivos}" class="btn-secondary-custom">
              <i class="bi bi-archive"></i> Ver Inactivos
            </a>

            <!-- SUBIDA DE CSV -->
            <form
              th:action="@{/cargarEmpresa}"
              method="post"
              enctype="multipart/form-data"
            >
              <input
                type="file"
                id="fileInput"
                name="file"
                accept=".csv"
                style="display: none"
                onchange="this.form.submit()"
              />

              <button
                type="button"
                class="btn-primary-custom"
                onclick="document.getElementById('fileInput').click();"
              >
                <i class="bi bi-upload"></i> Cargar CSV
              </button>
            </form>
          </div>
        </div>

        <!-- Mensaje de éxito -->
        <div
          th:if="${success}"
          class="alert alert-success mb-3"
          th:text="${success}"
        ></div>

        <!-- ======================================== -->
        <!--   FILTROS Y BUSQUEDA                     -->
        <!-- ======================================== -->
        <div class="card-custom mb-3">
          <div class="d-flex justify-content-between align-items-center">
            <span class="badge bg-success">
              Total Activas: <span th:text="${empresas.size()}"></span>
            </span>

            <form
              th:action="@{/empresas/buscar}"
              method="get"
              class="d-flex gap-2"
            >
              <input
                type="text"
                class="form-control input-small"
                name="busqueda"
                placeholder="Buscar empresa..."
                th:value="${busqueda}"
              />

              <button type="submit" class="btn-primary-custom">
                <i class="bi bi-search"></i>
              </button>

              <a th:href="@{/empresas}" class="btn-secondary-custom">
                <i class="bi bi-arrow-clockwise"></i>
              </a>
            </form>
          </div>
        </div>

        <!-- ======================================== -->
        <!--                 TABLA                    -->
        <!-- ======================================== -->
        <div class="table-responsive">
          <table class="table table-modern">
            <thead >
              <tr>
                <th>ID</th>
                <th>NIT</th>
                <th>Nombre</th>
                <th>Área</th>
                <th>Contacto</th>
                <th>Ubicación</th>
                <th>Estado</th>
                <th class="text-center">Acciones</th>
              </tr>
            </thead>

            <tbody>
              <tr th:each="empresa : ${empresas}">
                <td th:text="${empresa.id}"></td>
                <td th:text="${empresa.nit}"></td>
                <td th:text="${empresa.nombre}"></td>
                <td th:text="${empresa.area}"></td>
                <td th:text="${empresa.contacto}"></td>
                <td th:text="${empresa.ubicacion}"></td>

                <td>
                  <span class="badge bg-success">Activo</span>
                </td>

                <td class="text-center">
                  <div class="d-flex gap-2">
                    <!-- VER -->
                    <a
                      th:href="@{'/empresas/' + ${empresa.id}}"
                      class="btn-read table-btn"
                    >
                      <i class="bi bi-eye"></i>
                    </a>

                    <!-- EDITAR -->
                    <a
                      th:href="@{'/empresas/' + ${empresa.id} + '/edit'}"
                      class="btn-update table-btn"
                      sec:authorize="hasRole('Administrador')"
                    >
                      <i class="bi bi-pencil-square"></i>
                    </a>

                    <!-- DESACTIVAR -->
                    <form
                      th:action="@{'/empresas/' + ${empresa.id} + '/desactivar'}"
                      method="post"
                      style="display: inline-block"
                      onsubmit="return confirm('¿Desactivar esta empresa?')"
                      sec:authorize="hasRole('Administrador')"
                    >
                      <button type="submit" class="btn-delete table-btn">
                        <i class="bi bi-power"></i>
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </body>
</html>

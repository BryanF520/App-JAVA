<!DOCTYPE html>
<html
  lang="es"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/app.html}"
>
  <head>
    <meta charset="UTF-8" />
    <title layout:fragment="pageTitle">Reportes</title>
  </head>

  <body>
    <section layout:fragment="content">
      <div class="container mt-4">
        <!-- Título -->
        <h2 class="page-title text-center mb-4">Reportes de Accesos</h2>

        <!-- ========= Formulario de filtros ========= -->
        <div class="card-custom mb-4">
          <div class="card-header-custom">Filtros de búsqueda</div>
          <div class="card-body">
            <form th:action="@{/reportes}" method="get">
              <div class="row g-3">
                <div class="col-md-3">
                  <input
                    type="text"
                    name="nombre"
                    class="form-control"
                    placeholder="Nombre"
                    th:value="${param.nombre}"
                  />
                </div>
                <div class="col-md-3">
                  <input
                    type="text"
                    name="apellido"
                    class="form-control"
                    placeholder="Apellido"
                    th:value="${param.apellido}"
                  />
                </div>
                <div class="col-md-3">
                  <input
                    type="date"
                    name="fecha"
                    class="form-control"
                    th:value="${param.fecha}"
                  />
                </div>
                <div class="col-md-3">
                  <select name="empresaId" id="empresa_id" class="form-control">
                    <option value="">Seleccione una empresa</option>
                    <option
                      th:each="empresa : ${empresas}"
                      th:value="${empresa.id}"
                      th:text="${empresa.nombre}"
                    ></option>
                  </select>
                </div>
              </div>

              <!-- Botones -->
              <div class="row mt-3 mb-2">
                <div class="col text-center">
                  <button type="submit" class="btn-primary-custom">
                    <i class="bi bi-search"></i> Buscar
                  </button>
                  <a
                    th:if="${descargable}"
                    th:href="@{/reportes/pdf(nombre=${param.nombre}, apellido=${param.apellido}, fecha=${param.fecha}, empresa=${param.empresaId})}"
                    class="btn-delete ms-2"
                  >
                    <i class="bi bi-arrow-down-circle"></i> Descargar PDF
                  </a>
                  <a
                    th:href="@{/correo/redactarCorreo}"
                    class="btn-activate ms-2"
                  >
                    <i class="bi bi-arrow-return-right"></i> Enviar al correo
                  </a>
                  <a th:href="@{/reportes}" class="btn-secondary-custom ms-2">
                    <i class="bi bi-arrow-clockwise"></i>
                  </a>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- ========= Mensajes ========= -->
        <div th:if="${error}" class="alert alert-danger text-center mb-3">
          <span th:text="${error}"></span>
        </div>
        <div
          th:if="${buscado} and ${#lists.isEmpty(accesos)}"
          class="alert alert-info text-center mb-3"
        >
          No se encontraron accesos con los criterios especificados.
        </div>

        <!-- ========= Tabla de resultados ========= -->
        <div th:if="${!#lists.isEmpty(accesos)}" class="table-responsive">
          <table class="table table-modern">
            <thead>
              <tr>
                <th>Nombre completo</th>
                <th>Apellidos</th>
                <th>Fecha de ingreso</th>
                <th>Empresa</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="acceso : ${accesos}">
                <td
                  th:text="${acceso.persona.nombreUno + ' ' + (acceso.persona.nombreDos ?: '')}"
                ></td>
                <td
                  th:text="${acceso.persona.apellidoUno + ' ' + (acceso.persona.apellidoDos ?: '')}"
                ></td>
                <td
                  th:text="${#temporals.format(acceso.fecha_ingreso,'dd/MM/yyyy')}"
                ></td>
                <td th:text="${acceso.empresa.nombre}"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </body>
</html>
